
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/favicon.ico" rel="icon" type="image/x-icon">
    <title>Running Ensemble Inference &#8212; Earth-2 MIP 0.1.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="../_static/documentation_options.js?v=01f34227"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/01_ensemble_inference';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/NVIDIA/earth2mip/gh-pages/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'main';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basic Inference with Multiple Models" href="02_model_comparison.html" />
    <link rel="prev" title="Examples" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">Earth-2 MIP is in Beta! Expect potential API instability!</div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/NVIDIA-Logo-V-ForScreen-ForLightBG.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/NVIDIA-Logo-V-ForScreen-ForDarkBG.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Earth-2 MIP</p>
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../userguide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Contributor Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../modules/index.html">
                        API
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2mip/blob/main/CHANGELOG.md">
                    Changelog
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/earth2mip" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../userguide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../community/index.html">
                        Contributor Guide
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../modules/index.html">
                        API
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/NVIDIA/earth2mip/blob/main/CHANGELOG.md">
                    Changelog
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NVIDIA/earth2mip" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Running Ensemble Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_model_comparison.html">Basic Inference with Multiple Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_model_scoring.html">Scoring Models</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Running...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-examples-01-ensemble-inference-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="running-ensemble-inference">
<span id="sphx-glr-examples-01-ensemble-inference-py"></span><h1>Running Ensemble Inference<a class="headerlink" href="#running-ensemble-inference" title="Link to this heading">#</a></h1>
<p>The following notebook demostrates how to use Earth-2 MIP’s config schema and builtin
inference workflows to perform ensemmble inference of the FourCastNetv2 small (FCNv2-sm)
weather model with an intial state pulled from the Climate Data Store (CDS) and
perturbed with random noise. The ensemble output will then be loaded into an Xarray
Dataset and some sample data analysis is provided.</p>
<p>In summary this notebook will cover the following topics:</p>
<ul class="simple">
<li><p>Configuring and setting up FCNv2 model registry</p></li>
<li><p>An ensemble configuration file</p></li>
<li><p>Running ensemble inference in Earth-2 MIP to produce an xarray DataSet</p></li>
<li><p>Post processing results</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ## Set Up</span>

<span class="c1"># Starting off with imports, hopefully you have already installed Earth-2 MIP from this</span>
<span class="c1"># repository. There are a few additional packages needed.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">xarray</span>
</pre></div>
</div>
<p>Prior to importing Earth-2 MIP, users need to be aware of a few enviroment variables
which can be used to customize Earth-2 MIPs global behavior. These must be set prior to
importing Earth-2 MIP. There are a number of different configuration options, some to
consider are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># - `WORLD_SIZE`: Tells Earth-2 MIP (which uses Modulus under the hood) the number of GPUs</span>
<span class="c1">#     to use for inferencing.</span>
<span class="c1"># - `MODEL_REGISTRY`: This variable tells Earth-2 MIP where location the model registery.</span>
<span class="c1">#     By default this is located in `${HOME}/.cache/earth2mip/models`.</span>

<span class="c1"># *Key Concept*: A model registry is a folder that Earth-2 MIP will explore to find model</span>
<span class="c1"># checkpoints to load. A folder containing the required fileds is referred to as a</span>
<span class="c1"># &quot;model package&quot;. Model packages typically consist of a few files such as:</span>

<span class="c1"># - `weights.tar`/`weights.mdlus`: the model checkpoint to load</span>
<span class="c1"># - `metadata.json`: a JSON file that contains meta info regarding various details for</span>
<span class="c1">#     using the model</span>
<span class="c1"># - `config.json`: constains parameters needed to instantiate the model object in python</span>
<span class="c1"># - `global_means.npy`: A numpy array containing the mean values used for normalization of</span>
<span class="c1">#     data in the model</span>
<span class="c1"># - `global_std.npy`: A numpy array containing the standard deviation values used for</span>
<span class="c1">#     normalization of data in the model</span>
</pre></div>
</div>
<p>For this example Set number of GPUs to use to 1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WORLD_SIZE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<span class="c1"># Use the default location for the model registry, but one can change its location</span>
<span class="c1"># os.environ[&#39;MODEL_REGISTRY&#39;] = &quot;/my/file/path/&quot;</span>

<span class="c1"># With the enviroment variables set now we import Earth-2 MIP</span>
<span class="kn">from</span> <span class="nn">earth2mip</span> <span class="kn">import</span> <span class="n">inference_ensemble</span><span class="p">,</span> <span class="n">registry</span>
</pre></div>
</div>
<p>The cell above created a model registry folder for us, but if this is your first
notebook its likely empty. Lets fix that. As previously metioned we will be using the
FCNv2-sm weather model with the checkpoint provided on the Nvidia Modulus model
registry. The model is shipped via a zip folder containing the required checkpoint files
discussed above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Since this model is built into Earth-2 MIP, the `registry.get_model` function can be</span>
<span class="c1"># used to auto-download and extract it (this can take a bit).</span>
<span class="c1"># The `e2mip://` prefix on the model URI, will point Earth-2 MIP to use the package</span>
<span class="c1"># fetch methods built into the model.</span>
<span class="c1"># Without it, Earth-2 MIP will simply look for a `fcnv2_sm` folder in your model registry</span>
<span class="c1"># and not attempt to download anything for you.</span>
<span class="c1"># Once complete, go look in your `MODEL_REGISTRY` folder and the files needed for FCNv2</span>
<span class="c1"># should now be present.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fetching model package...&quot;</span><span class="p">)</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;e2mip://fcnv2_sm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Fetching model package...
</pre></div>
</div>
<p>The final setup step is to set up your CDS API key so we can access ERA5 data to act as
an initial state. Earth-2 MIP supports a number of different initial state data sources
that are supported including HDF5, CDS, GFS, etc. The CDS initial state provides a
convenient way to access a limited amount of historical weather data. Its recommended
for accessing an initial state, but larger data requirements should use locally stored
weather datasets.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enter your CDS API uid and key below (found under your profile page).</span>
<span class="c1"># If you don&#39;t a CDS API key, find out more here.</span>
<span class="c1"># - [https://cds.climate.copernicus.eu/cdsapp#!/home](https://cds.climate.copernicus.eu/cdsapp#!/home)</span>
<span class="c1"># - [https://cds.climate.copernicus.eu/api-how-to](https://cds.climate.copernicus.eu/api-how-to)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cds_api</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">),</span> <span class="s2">&quot;.cdsapirc&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">cds_api</span><span class="p">):</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter in CDS UID (e.g. 123456): &quot;</span><span class="p">)</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your CDS API key (e.g. 12345678-1234-1234-1234-123456123456): &quot;</span><span class="p">)</span>
    <span class="c1"># Write to config file for CDS library</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cds_api</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;url: https://cds.climate.copernicus.eu/api/v2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key: </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">## Running Inference</span>

<span class="sd">To run inference we will use the `earth2mip/ensemble_inference.py` part of Earth-2 MIP.</span>
<span class="sd">When this Python file, we provide either a config JSON file or a JSON serialized string</span>
<span class="sd">for it to parse. This config contains the information regarding how the model should run</span>
<span class="sd">inference. The schema of this can be found in `earth2mip/schema/EnsembleRun`.</span>

<span class="sd">Since we are working in a notebook, lets create this config Pythonically. There are</span>
<span class="sd">quite a few parameters that can be used, but lets focus in on a few key ones:</span>

<span class="sd">- `ensemble_members`: Number ensemble members in the forecast</span>
<span class="sd">- `noise_amplitude`: The amplitude of the noise pertibation method (we find that a good</span>
<span class="sd">    value to start with is `0.05`, feel free to experiment)</span>
<span class="sd">- `simulation_length`: Number of (6h) time-steps to predict</span>
<span class="sd">- `weather_event`: This defines the weather event as a combination of an initial time</span>
<span class="sd">    and a domain.</span>
<span class="sd">    * The domain property defines the IO, ,by telling Earth-2 MIP for what regions</span>
<span class="sd">    (if `window`) or points (if `multipoint`) data should be stored. It also defines the</span>
<span class="sd">    `channels` and the diagnostic.  In this example the global field is recorded for the</span>
<span class="sd">    `t2m` and `u10m` channels.</span>
<span class="sd">- `output_path`: The output location of the ensemble prediction netCDF file</span>
<span class="sd">- `weather_model`: The model ID to run. This MUST match the name of the model registry</span>
<span class="sd">    folder with your checkpoint files. So for this example its `fcnv2_sm`.</span>

<span class="sd">Note: While in later notebooks we will demonstrate more Pythonic methods to interact</span>
<span class="sd">with Earth-2 MIP&#39;s APIs, the built in inference workflows provide a high-degree of</span>
<span class="sd">control with little to no programming.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;\n## Running Inference\n\nTo run inference we will use the `earth2mip/ensemble_inference.py` part of Earth-2 MIP.\nWhen this Python file, we provide either a config JSON file or a JSON serialized string\nfor it to parse. This config contains the information regarding how the model should run\ninference. The schema of this can be found in `earth2mip/schema/EnsembleRun`.\n\nSince we are working in a notebook, lets create this config Pythonically. There are\nquite a few parameters that can be used, but lets focus in on a few key ones:\n\n- `ensemble_members`: Number ensemble members in the forecast\n- `noise_amplitude`: The amplitude of the noise pertibation method (we find that a good\n    value to start with is `0.05`, feel free to experiment)\n- `simulation_length`: Number of (6h) time-steps to predict\n- `weather_event`: This defines the weather event as a combination of an initial time\n    and a domain.\n    * The domain property defines the IO, ,by telling Earth-2 MIP for what regions\n    (if `window`) or points (if `multipoint`) data should be stored. It also defines the\n    `channels` and the diagnostic.  In this example the global field is recorded for the\n    `t2m` and `u10m` channels.\n- `output_path`: The output location of the ensemble prediction netCDF file\n- `weather_model`: The model ID to run. This MUST match the name of the model registry\n    folder with your checkpoint files. So for this example its `fcnv2_sm`.\n\nNote: While in later notebooks we will demonstrate more Pythonic methods to interact\nwith Earth-2 MIP&#39;s APIs, the built in inference workflows provide a high-degree of\ncontrol with little to no programming.\n&quot;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ensemble_members&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;noise_amplitude&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;simulation_length&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;weather_event&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Globe&quot;</span><span class="p">,</span>
            <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-06-01 00:00:00&quot;</span><span class="p">,</span>
            <span class="s2">&quot;initial_condition_source&quot;</span><span class="p">:</span> <span class="s2">&quot;cds&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;domains&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Window&quot;</span><span class="p">,</span>
                <span class="s2">&quot;diagnostics&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="s2">&quot;channels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;u10m&quot;</span><span class="p">]}],</span>
            <span class="p">}</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="s2">&quot;output_path&quot;</span><span class="p">:</span> <span class="s2">&quot;outputs/01_ensemble_notebook&quot;</span><span class="p">,</span>
    <span class="s2">&quot;output_frequency&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;weather_model&quot;</span><span class="p">:</span> <span class="s2">&quot;fcnv2_sm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">12345</span><span class="p">,</span>
    <span class="s2">&quot;use_cuda_graphs&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;ensemble_batch_size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;autocast_fp16&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;perturbation_strategy&quot;</span><span class="p">:</span> <span class="s2">&quot;correlated&quot;</span><span class="p">,</span>
    <span class="s2">&quot;noise_reddening&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Now we run the `main()` function in `earth2mip.inference_ensemble` providing our config</span>
<span class="sd">object which will run inference with the following steps:</span>

<span class="sd">1. Instantiate and load the FCNv2 small weather model onto the device</span>
<span class="sd">2. Download the initial state data needed from CDS using your saved API key</span>
<span class="sd">3. Perturb the initial state based on the parameters in the config and run a forecast</span>
<span class="sd">    predicton</span>
<span class="sd">4. Save output Xarray dataset to NetCDF file located in</span>
<span class="sd">    `../outputs/01_ensemble_notebook`</span>

<span class="sd">(the process may take a while!)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nNow we run the `main()` function in `earth2mip.inference_ensemble` providing our config\nobject which will run inference with the following steps:\n\n1. Instantiate and load the FCNv2 small weather model onto the device\n2. Download the initial state data needed from CDS using your saved API key\n3. Perturb the initial state based on the parameters in the config and run a forecast\n    predicton\n4. Save output Xarray dataset to NetCDF file located in\n    `../outputs/01_ensemble_notebook`\n\n(the process may take a while!)\n&#39;
</pre></div>
</div>
<p>Option 1: Use config file and CLI (use this outside a notebook)
with open(‘./01_config.json’, ‘w’) as f:</p>
<blockquote>
<div><p>json.dump(config, f)</p>
</div></blockquote>
<p>! python3 -m earth2mip.inference_ensemble 01_config.json</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Option 2: Feed in JSON string directly into main function</span>
<span class="n">config_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<span class="n">inference_ensemble</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">config_str</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>INFO:root:Earth-2 MIP config loaded weather_model=&#39;fcnv2_sm&#39; simulation_length=10 perturbation_strategy=&lt;PerturbationStrategy.correlated: &#39;correlated&#39;&gt; perturbation_channels=None noise_reddening=2.0 noise_amplitude=0.05 output_frequency=1 output_grid=None ensemble_members=4 seed=12345 ensemble_batch_size=1 forecast_name=None weather_event=WeatherEvent(properties=WeatherEventProperties(name=&#39;Globe&#39;, start_time=datetime.datetime(2018, 6, 1, 0, 0), initial_condition_source=&lt;InitialConditionSource.cds: &#39;cds&#39;&gt;, netcdf=&#39;&#39;, restart=&#39;&#39;), domains=[Window(type=&#39;Window&#39;, name=&#39;global&#39;, lat_min=-90, lat_max=90, lon_min=0, lon_max=360, diagnostics=[Diagnostic(type=&#39;raw&#39;, function=&#39;&#39;, channels=[&#39;t2m&#39;, &#39;u10m&#39;], nbins=10)])]) output_dir=None output_path=&#39;outputs/01_ensemble_notebook&#39; restart_frequency=None grf_noise_alpha=2.0 grf_noise_sigma=5.0 grf_noise_tau=2.0
INFO:root:Loading model onto device cuda:0
INFO:root:Constructing initializer data source
INFO:root:Running inference
INFO:earth2mip.initial_conditions.cds:Found data in cache. Using /root/.cache/earth2mip/cds/554d2477eace4300c920ab161c2fa95b0053649ab9e5c8d43eaa9f5f9b6d248c/reanalysis-era5-pressure-levels.grib.
INFO:earth2mip.initial_conditions.cds:Found data in cache. Using /root/.cache/earth2mip/cds/a4d33dfecb006b7ab66638da1c524bc2f379c7b5f2f954d904c72eeeeadfcb40/reanalysis-era5-single-levels.grib.
INFO:inference:ensemble members 1-1/4
INFO:inference:ensemble members 2-2/4
INFO:inference:ensemble members 3-3/4
INFO:inference:ensemble members 4-4/4
INFO:inference:Ensemble forecast finished, saved to: outputs/01_ensemble_notebook/ensemble_out_0.nc
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">When the inference is complete we can examine the output in</span>
<span class="sd">`ouputs/01_ensemble_notebook/ensemble_out_0.nc`.</span>

<span class="sd">Note: if the inference is distributed across N GPUs there will be `ensemble_out_0.nc`,</span>
<span class="sd">`ensemble_out_1.nc`, ... `ensemble_out_N-1.nc` output files.</span>
<span class="sd">In this case a function like this could concat the files to a single xarray DataArray:</span>

<span class="sd">```python</span>
<span class="sd">def _open(f, domain, time, chunks={&quot;time&quot;: 1}):</span>
<span class="sd">    root = xarray.open_dataset(f, decode_times=False)</span>
<span class="sd">    ds = xarray.open_dataset(f, chunks=chunks, group=domain)</span>
<span class="sd">    ds.attrs = root.attrs</span>
<span class="sd">    return ds.assign_coords(time=lead_time)</span>


<span class="sd">def open_ensemble(path, domain, time):</span>
<span class="sd">    path = pathlib.Path(path)</span>
<span class="sd">    ensemble_files = list(path.glob(&quot;ensemble_out_*.nc&quot;))</span>
<span class="sd">    return xarray.concat(</span>
<span class="sd">        [_open(f, group, time) for f in ensemble_files], dim=&quot;ensemble&quot;</span>
<span class="sd">    )</span>
<span class="sd">```</span>

<span class="sd">(TODO: Parallel inference / scoring example)</span>

<span class="sd">But with our single NetCDF file we can load it into a</span>
<span class="sd">[Xarray Dataset](https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html) with</span>
<span class="sd">just a few lines of code.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nWhen the inference is complete we can examine the output in\n`ouputs/01_ensemble_notebook/ensemble_out_0.nc`.\n\nNote: if the inference is distributed across N GPUs there will be `ensemble_out_0.nc`,\n`ensemble_out_1.nc`, ... `ensemble_out_N-1.nc` output files.\nIn this case a function like this could concat the files to a single xarray DataArray:\n\n```python\ndef _open(f, domain, time, chunks={&quot;time&quot;: 1}):\n    root = xarray.open_dataset(f, decode_times=False)\n    ds = xarray.open_dataset(f, chunks=chunks, group=domain)\n    ds.attrs = root.attrs\n    return ds.assign_coords(time=lead_time)\n\n\ndef open_ensemble(path, domain, time):\n    path = pathlib.Path(path)\n    ensemble_files = list(path.glob(&quot;ensemble_out_*.nc&quot;))\n    return xarray.concat(\n        [_open(f, group, time) for f in ensemble_files], dim=&quot;ensemble&quot;\n    )\n```\n\n(TODO: Parallel inference / scoring example)\n\nBut with our single NetCDF file we can load it into a\n[Xarray Dataset](https://docs.xarray.dev/en/stable/generated/xarray.Dataset.html) with\njust a few lines of code.\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">open_ensemble</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">time</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">attrs</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>


<span class="n">output_path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;output_path&quot;</span><span class="p">]</span>
<span class="n">domains</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;weather_event&quot;</span><span class="p">][</span><span class="s2">&quot;domains&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<span class="n">ensemble_members</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;ensemble_members&quot;</span><span class="p">]</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">open_ensemble</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;ensemble_out_0.nc&quot;</span><span class="p">),</span> <span class="n">domains</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:  (lat: 721, lon: 1440, ensemble: 4, time: 11)
Coordinates:
  * lat      (lat) float32 90.0 89.75 89.5 89.25 ... -89.25 -89.5 -89.75 -90.0
  * lon      (lon) float32 0.0 0.25 0.5 0.75 1.0 ... 359.0 359.2 359.5 359.8
  * time     (time) datetime64[ns] 2018-06-01 ... 2018-06-03T12:00:00
Dimensions without coordinates: ensemble
Data variables:
    imin     int64 ...
    imax     int64 ...
    jmin     int64 ...
    jmax     int64 ...
    t2m      (ensemble, time, lat, lon) float64 dask.array&lt;chunksize=(4, 1, 721, 1440), meta=np.ndarray&gt;
    u10m     (ensemble, time, lat, lon) float64 dask.array&lt;chunksize=(4, 1, 721, 1440), meta=np.ndarray&gt;
Attributes:
    model:          fcnv2_sm
    config:         {&quot;weather_model&quot;: &quot;fcnv2_sm&quot;, &quot;simulation_length&quot;: 10, &quot;p...
    weather_event:  {&quot;properties&quot;: {&quot;name&quot;: &quot;Globe&quot;, &quot;start_time&quot;: &quot;2018-06-0...
    date_created:   2023-11-17T20:31:17.384814
    history:        /ngeneva/code/earth2mip/examples/notebooks/01_ensemble_in...
    institution:    NVIDIA
    Conventions:    CF-1.10</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-083c77f7-0a26-4b15-abb3-7bdb9d319b26' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-083c77f7-0a26-4b15-abb3-7bdb9d319b26' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>lat</span>: 721</li><li><span class='xr-has-index'>lon</span>: 1440</li><li><span>ensemble</span>: 4</li><li><span class='xr-has-index'>time</span>: 11</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-d5f08501-ecd1-4a43-a6e1-220a01058c74' class='xr-section-summary-in' type='checkbox'  checked><label for='section-d5f08501-ecd1-4a43-a6e1-220a01058c74' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>90.0 89.75 89.5 ... -89.75 -90.0</div><input id='attrs-40a8fa2d-4cd2-44a8-8f00-18935cb10edd' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-40a8fa2d-4cd2-44a8-8f00-18935cb10edd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e2cce591-262b-497b-bb3d-b3dcbf1ce935' class='xr-var-data-in' type='checkbox'><label for='data-e2cce591-262b-497b-bb3d-b3dcbf1ce935' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd></dl></div><div class='xr-var-data'><pre>array([ 90.  ,  89.75,  89.5 , ..., -89.5 , -89.75, -90.  ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.25 0.5 ... 359.2 359.5 359.8</div><input id='attrs-a04bfc7b-acec-4735-90e6-023de020bdce' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a04bfc7b-acec-4735-90e6-023de020bdce' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cb9eb387-56d8-4169-87c6-ec86ca2e764e' class='xr-var-data-in' type='checkbox'><label for='data-cb9eb387-56d8-4169-87c6-ec86ca2e764e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>longitude</dd></dl></div><div class='xr-var-data'><pre>array([0.0000e+00, 2.5000e-01, 5.0000e-01, ..., 3.5925e+02, 3.5950e+02,
       3.5975e+02], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2018-06-01 ... 2018-06-03T12:00:00</div><input id='attrs-30e6d43d-cb89-4098-b089-5f2fd35790d0' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-30e6d43d-cb89-4098-b089-5f2fd35790d0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8a90f8c-4814-4ea5-ac46-bd194f2c3430' class='xr-var-data-in' type='checkbox'><label for='data-c8a90f8c-4814-4ea5-ac46-bd194f2c3430' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2018-06-01T00:00:00.000000000&#x27;, &#x27;2018-06-01T06:00:00.000000000&#x27;,
       &#x27;2018-06-01T12:00:00.000000000&#x27;, &#x27;2018-06-01T18:00:00.000000000&#x27;,
       &#x27;2018-06-02T00:00:00.000000000&#x27;, &#x27;2018-06-02T06:00:00.000000000&#x27;,
       &#x27;2018-06-02T12:00:00.000000000&#x27;, &#x27;2018-06-02T18:00:00.000000000&#x27;,
       &#x27;2018-06-03T00:00:00.000000000&#x27;, &#x27;2018-06-03T06:00:00.000000000&#x27;,
       &#x27;2018-06-03T12:00:00.000000000&#x27;], dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-495a5958-c4c9-4213-8bf6-92c44c1b36ca' class='xr-section-summary-in' type='checkbox'  checked><label for='section-495a5958-c4c9-4213-8bf6-92c44c1b36ca' class='xr-section-summary' >Data variables: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>imin</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-d7c5546f-f75e-4e08-8c5d-ab1d2cc07c8d' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d7c5546f-f75e-4e08-8c5d-ab1d2cc07c8d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c9ec9e7c-851b-4332-b5f8-31350e923594' class='xr-var-data-in' type='checkbox'><label for='data-c9ec9e7c-851b-4332-b5f8-31350e923594' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>imax</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-ed66cbd1-ccb2-4304-9bbf-9a44ab777655' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ed66cbd1-ccb2-4304-9bbf-9a44ab777655' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6f3a172c-a490-42c9-8207-e09ed716c0a6' class='xr-var-data-in' type='checkbox'><label for='data-6f3a172c-a490-42c9-8207-e09ed716c0a6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>jmin</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-2783cfee-edf4-478c-8cbd-67ec4500226a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2783cfee-edf4-478c-8cbd-67ec4500226a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-44c866df-9927-4d1f-a9b7-ab92982cf530' class='xr-var-data-in' type='checkbox'><label for='data-44c866df-9927-4d1f-a9b7-ab92982cf530' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>jmax</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-eafe06a9-3e71-49f1-b600-768545048317' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-eafe06a9-3e71-49f1-b600-768545048317' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-81abf1a9-dae5-4d91-b4ef-6d34531c2114' class='xr-var-data-in' type='checkbox'><label for='data-81abf1a9-dae5-4d91-b4ef-6d34531c2114' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>[1 values with dtype=int64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>t2m</span></div><div class='xr-var-dims'>(ensemble, time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(4, 1, 721, 1440), meta=np.ndarray&gt;</div><input id='attrs-f13fe3c5-db7d-4fe0-9fe5-6944060fe7d2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f13fe3c5-db7d-4fe0-9fe5-6944060fe7d2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5fbc6a2e-af37-4332-8b5a-488310de4e30' class='xr-var-data-in' type='checkbox'><label for='data-5fbc6a2e-af37-4332-8b5a-488310de4e30' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 348.53 MiB </td>
                        <td> 31.68 MiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 11, 721, 1440) </td>
                        <td> (4, 1, 721, 1440) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 11 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="374" height="125" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="25" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="25" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="25" y1="0" x2="25" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 25.412616514582485,0.0 25.412616514582485,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="12.706308" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >4</text>
  <text x="45.412617" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,45.412617,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="95" y1="0" x2="109" y2="14" style="stroke-width:2" />
  <line x1="95" y1="60" x2="109" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="95" y1="0" x2="95" y2="60" style="stroke-width:2" />
  <line x1="96" y1="1" x2="96" y2="61" />
  <line x1="97" y1="2" x2="97" y2="62" />
  <line x1="99" y1="4" x2="99" y2="64" />
  <line x1="100" y1="5" x2="100" y2="65" />
  <line x1="101" y1="6" x2="101" y2="66" />
  <line x1="103" y1="8" x2="103" y2="68" />
  <line x1="104" y1="9" x2="104" y2="69" />
  <line x1="105" y1="10" x2="105" y2="70" />
  <line x1="107" y1="12" x2="107" y2="72" />
  <line x1="108" y1="13" x2="108" y2="73" />
  <line x1="109" y1="14" x2="109" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="95.0,0.0 109.9485979497544,14.948597949754403 109.9485979497544,75.03193128308774 95.0,60.083333333333336" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="95" y1="0" x2="215" y2="0" style="stroke-width:2" />
  <line x1="96" y1="1" x2="216" y2="1" />
  <line x1="97" y1="2" x2="217" y2="2" />
  <line x1="99" y1="4" x2="219" y2="4" />
  <line x1="100" y1="5" x2="220" y2="5" />
  <line x1="101" y1="6" x2="221" y2="6" />
  <line x1="103" y1="8" x2="223" y2="8" />
  <line x1="104" y1="9" x2="224" y2="9" />
  <line x1="105" y1="10" x2="225" y2="10" />
  <line x1="107" y1="12" x2="227" y2="12" />
  <line x1="108" y1="13" x2="228" y2="13" />
  <line x1="109" y1="14" x2="229" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="95" y1="0" x2="109" y2="14" style="stroke-width:2" />
  <line x1="215" y1="0" x2="229" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="95.0,0.0 215.0,0.0 229.9485979497544,14.948597949754403 109.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="109" y1="14" x2="229" y2="14" style="stroke-width:2" />
  <line x1="109" y1="75" x2="229" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="109" y1="14" x2="109" y2="75" style="stroke-width:2" />
  <line x1="229" y1="14" x2="229" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="109.9485979497544,14.948597949754403 229.9485979497544,14.948597949754403 229.9485979497544,75.03193128308774 109.9485979497544,75.03193128308774" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="169.948598" y="95.031931" font-size="1.0rem" font-weight="100" text-anchor="middle" >1440</text>
  <text x="249.948598" y="44.990265" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,249.948598,44.990265)">721</text>
  <text x="92.474299" y="87.557632" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,92.474299,87.557632)">11</text>
</svg>
        </td>
    </tr>
</table></div></li><li class='xr-var-item'><div class='xr-var-name'><span>u10m</span></div><div class='xr-var-dims'>(ensemble, time, lat, lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>dask.array&lt;chunksize=(4, 1, 721, 1440), meta=np.ndarray&gt;</div><input id='attrs-04fb4348-2560-40c6-9fed-f1c0f32c326c' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-04fb4348-2560-40c6-9fed-f1c0f32c326c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ff2a8bd0-eb88-4428-ae57-4fcea6f222b3' class='xr-var-data-in' type='checkbox'><label for='data-ff2a8bd0-eb88-4428-ae57-4fcea6f222b3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><table>
    <tr>
        <td>
            <table style="border-collapse: collapse;">
                <thead>
                    <tr>
                        <td> </td>
                        <th> Array </th>
                        <th> Chunk </th>
                    </tr>
                </thead>
                <tbody>

                    <tr>
                        <th> Bytes </th>
                        <td> 348.53 MiB </td>
                        <td> 31.68 MiB </td>
                    </tr>

                    <tr>
                        <th> Shape </th>
                        <td> (4, 11, 721, 1440) </td>
                        <td> (4, 1, 721, 1440) </td>
                    </tr>
                    <tr>
                        <th> Dask graph </th>
                        <td colspan="2"> 11 chunks in 2 graph layers </td>
                    </tr>
                    <tr>
                        <th> Data type </th>
                        <td colspan="2"> float64 numpy.ndarray </td>
                    </tr>
                </tbody>
            </table>
        </td>
        <td>
        <svg width="374" height="125" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="25" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="25" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="25" y1="0" x2="25" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.0,0.0 25.412616514582485,0.0 25.412616514582485,25.412616514582485 0.0,25.412616514582485" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="12.706308" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >4</text>
  <text x="45.412617" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,45.412617,12.706308)">1</text>


  <!-- Horizontal lines -->
  <line x1="95" y1="0" x2="109" y2="14" style="stroke-width:2" />
  <line x1="95" y1="60" x2="109" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="95" y1="0" x2="95" y2="60" style="stroke-width:2" />
  <line x1="96" y1="1" x2="96" y2="61" />
  <line x1="97" y1="2" x2="97" y2="62" />
  <line x1="99" y1="4" x2="99" y2="64" />
  <line x1="100" y1="5" x2="100" y2="65" />
  <line x1="101" y1="6" x2="101" y2="66" />
  <line x1="103" y1="8" x2="103" y2="68" />
  <line x1="104" y1="9" x2="104" y2="69" />
  <line x1="105" y1="10" x2="105" y2="70" />
  <line x1="107" y1="12" x2="107" y2="72" />
  <line x1="108" y1="13" x2="108" y2="73" />
  <line x1="109" y1="14" x2="109" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="95.0,0.0 109.9485979497544,14.948597949754403 109.9485979497544,75.03193128308774 95.0,60.083333333333336" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="95" y1="0" x2="215" y2="0" style="stroke-width:2" />
  <line x1="96" y1="1" x2="216" y2="1" />
  <line x1="97" y1="2" x2="217" y2="2" />
  <line x1="99" y1="4" x2="219" y2="4" />
  <line x1="100" y1="5" x2="220" y2="5" />
  <line x1="101" y1="6" x2="221" y2="6" />
  <line x1="103" y1="8" x2="223" y2="8" />
  <line x1="104" y1="9" x2="224" y2="9" />
  <line x1="105" y1="10" x2="225" y2="10" />
  <line x1="107" y1="12" x2="227" y2="12" />
  <line x1="108" y1="13" x2="228" y2="13" />
  <line x1="109" y1="14" x2="229" y2="14" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="95" y1="0" x2="109" y2="14" style="stroke-width:2" />
  <line x1="215" y1="0" x2="229" y2="14" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="95.0,0.0 215.0,0.0 229.9485979497544,14.948597949754403 109.9485979497544,14.948597949754403" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Horizontal lines -->
  <line x1="109" y1="14" x2="229" y2="14" style="stroke-width:2" />
  <line x1="109" y1="75" x2="229" y2="75" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="109" y1="14" x2="109" y2="75" style="stroke-width:2" />
  <line x1="229" y1="14" x2="229" y2="75" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="109.9485979497544,14.948597949754403 229.9485979497544,14.948597949754403 229.9485979497544,75.03193128308774 109.9485979497544,75.03193128308774" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="169.948598" y="95.031931" font-size="1.0rem" font-weight="100" text-anchor="middle" >1440</text>
  <text x="249.948598" y="44.990265" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,249.948598,44.990265)">721</text>
  <text x="92.474299" y="87.557632" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(45,92.474299,87.557632)">11</text>
</svg>
        </td>
    </tr>
</table></div></li></ul></div></li><li class='xr-section-item'><input id='section-031c8463-640b-41f5-9bf9-f6d6fea9b761' class='xr-section-summary-in' type='checkbox'  ><label for='section-031c8463-640b-41f5-9bf9-f6d6fea9b761' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>lat</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-defa556e-4335-465e-95d8-b56bf5b8ef2f' class='xr-index-data-in' type='checkbox'/><label for='index-defa556e-4335-465e-95d8-b56bf5b8ef2f' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([  90.0,  89.75,   89.5,  89.25,   89.0,  88.75,   88.5,  88.25,   88.0,
        87.75,
       ...
       -87.75,  -88.0, -88.25,  -88.5, -88.75,  -89.0, -89.25,  -89.5, -89.75,
        -90.0],
      dtype=&#x27;float32&#x27;, name=&#x27;lat&#x27;, length=721))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>lon</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-ae507463-d446-42c7-888e-5663c350257d' class='xr-index-data-in' type='checkbox'/><label for='index-ae507463-d446-42c7-888e-5663c350257d' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([   0.0,   0.25,    0.5,   0.75,    1.0,   1.25,    1.5,   1.75,    2.0,
         2.25,
       ...
        357.5, 357.75,  358.0, 358.25,  358.5, 358.75,  359.0, 359.25,  359.5,
       359.75],
      dtype=&#x27;float32&#x27;, name=&#x27;lon&#x27;, length=1440))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-d17f5d2d-0a68-46f1-b631-6f188ec2d079' class='xr-index-data-in' type='checkbox'/><label for='index-d17f5d2d-0a68-46f1-b631-6f188ec2d079' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2018-06-01 00:00:00&#x27;, &#x27;2018-06-01 06:00:00&#x27;,
               &#x27;2018-06-01 12:00:00&#x27;, &#x27;2018-06-01 18:00:00&#x27;,
               &#x27;2018-06-02 00:00:00&#x27;, &#x27;2018-06-02 06:00:00&#x27;,
               &#x27;2018-06-02 12:00:00&#x27;, &#x27;2018-06-02 18:00:00&#x27;,
               &#x27;2018-06-03 00:00:00&#x27;, &#x27;2018-06-03 06:00:00&#x27;,
               &#x27;2018-06-03 12:00:00&#x27;],
              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4ccfe801-1b1f-4289-aa20-506789463e04' class='xr-section-summary-in' type='checkbox'  checked><label for='section-4ccfe801-1b1f-4289-aa20-506789463e04' class='xr-section-summary' >Attributes: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>model :</span></dt><dd>fcnv2_sm</dd><dt><span>config :</span></dt><dd>{&quot;weather_model&quot;: &quot;fcnv2_sm&quot;, &quot;simulation_length&quot;: 10, &quot;perturbation_strategy&quot;: &quot;correlated&quot;, &quot;perturbation_channels&quot;: null, &quot;noise_reddening&quot;: 2.0, &quot;noise_amplitude&quot;: 0.05, &quot;output_frequency&quot;: 1, &quot;output_grid&quot;: null, &quot;ensemble_members&quot;: 4, &quot;seed&quot;: 12345, &quot;ensemble_batch_size&quot;: 1, &quot;forecast_name&quot;: null, &quot;weather_event&quot;: {&quot;properties&quot;: {&quot;name&quot;: &quot;Globe&quot;, &quot;start_time&quot;: &quot;2018-06-01T00:00:00&quot;, &quot;initial_condition_source&quot;: &quot;cds&quot;, &quot;netcdf&quot;: &quot;&quot;, &quot;restart&quot;: &quot;&quot;}, &quot;domains&quot;: [{&quot;type&quot;: &quot;Window&quot;, &quot;name&quot;: &quot;global&quot;, &quot;lat_min&quot;: -90, &quot;lat_max&quot;: 90, &quot;lon_min&quot;: 0, &quot;lon_max&quot;: 360, &quot;diagnostics&quot;: [{&quot;type&quot;: &quot;raw&quot;, &quot;function&quot;: &quot;&quot;, &quot;channels&quot;: [&quot;t2m&quot;, &quot;u10m&quot;], &quot;nbins&quot;: 10}]}]}, &quot;output_dir&quot;: null, &quot;output_path&quot;: &quot;outputs/01_ensemble_notebook&quot;, &quot;restart_frequency&quot;: null, &quot;grf_noise_alpha&quot;: 2.0, &quot;grf_noise_sigma&quot;: 5.0, &quot;grf_noise_tau&quot;: 2.0}</dd><dt><span>weather_event :</span></dt><dd>{&quot;properties&quot;: {&quot;name&quot;: &quot;Globe&quot;, &quot;start_time&quot;: &quot;2018-06-01T00:00:00&quot;, &quot;initial_condition_source&quot;: &quot;cds&quot;, &quot;netcdf&quot;: &quot;&quot;, &quot;restart&quot;: &quot;&quot;}, &quot;domains&quot;: [{&quot;type&quot;: &quot;Window&quot;, &quot;name&quot;: &quot;global&quot;, &quot;lat_min&quot;: -90, &quot;lat_max&quot;: 90, &quot;lon_min&quot;: 0, &quot;lon_max&quot;: 360, &quot;diagnostics&quot;: [{&quot;type&quot;: &quot;raw&quot;, &quot;function&quot;: &quot;&quot;, &quot;channels&quot;: [&quot;t2m&quot;, &quot;u10m&quot;], &quot;nbins&quot;: 10}]}]}</dd><dt><span>date_created :</span></dt><dd>2023-11-17T20:31:17.384814</dd><dt><span>history :</span></dt><dd>/ngeneva/code/earth2mip/examples/notebooks/01_ensemble_inference.py</dd><dt><span>institution :</span></dt><dd>NVIDIA</dd><dt><span>Conventions :</span></dt><dd>CF-1.10</dd></dl></div></li></ul></div></div>
</div>
<br />
<br /><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">## Post Processing</span>

<span class="sd">With inference complete, now the fun part: post processing and analysis!</span>
<span class="sd">You can manipulate the data to your hearts content now that its in an Xarray Dataset.</span>
<span class="sd">Here we will demonstrate some common plotting / analysis workflows one may be</span>
<span class="sd">interested. Lets start off with importing all our post processing packages.</span>

<span class="sd">(You may need to pip install matplotlib and cartopy)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\n## Post Processing\n\nWith inference complete, now the fun part: post processing and analysis!\nYou can manipulate the data to your hearts content now that its in an Xarray Dataset.\nHere we will demonstrate some common plotting / analysis workflows one may be\ninterested. Lets start off with importing all our post processing packages.\n\n(You may need to pip install matplotlib and cartopy)\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">TwoSlopeNorm</span>

<span class="n">countries</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
    <span class="n">category</span><span class="o">=</span><span class="s2">&quot;cultural&quot;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;admin_0_countries&quot;</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="s2">&quot;50m&quot;</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Up first, we can plot a time series of the value of a variable (or statistics of that</span>
<span class="sd">variable) at a given location (lat/lon coord). In this case lets look at the results</span>
<span class="sd">predicted over New York.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nUp first, we can plot a time series of the value of a variable (or statistics of that\nvariable) at a given location (lat/lon coord). In this case lets look at the results\npredicted over New York.\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">lead_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>
<span class="p">)</span>
<span class="n">nyc_lat</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">nyc_lon</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">74</span>
<span class="n">NYC</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">nyc_lon</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">nyc_lat</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ensemble members&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_time</span><span class="p">,</span> <span class="n">NYC</span><span class="o">.</span><span class="n">u10m</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;u10m [m/s]&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;deviation from ensemble mean&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_time</span><span class="p">,</span> <span class="n">NYC</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">NYC</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;u10m [m/s]&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ensemble spread&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_time</span><span class="p">,</span> <span class="n">NYC</span><span class="o">.</span><span class="n">t2m</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s2">&quot;ensemble&quot;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;lead_time [h]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;std u10m [m/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">/new_york_zonal_winds.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_01_ensemble_inference_001.png" srcset="../_images/sphx_glr_01_ensemble_inference_001.png, ../_images/sphx_glr_01_ensemble_inference_001_2_00x.png 2.00x" alt="Ensemble members, deviation from ensemble mean, ensemble spread" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Next, lets plot some fields of surface temperature. Since we have an ensemble of</span>
<span class="sd">predictions, lets display the first ensemble member, which is deterministic member,</span>
<span class="sd">and also the last ensemble member and the ensemmble standard deviation. One or both of</span>
<span class="sd">the perturbed members may look a little noisy, thats because our noise amplitude is</span>
<span class="sd">maybe too high. Try lowering the amplitude in the config or changing pertibation type</span>
<span class="sd">to see what happens.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nNext, lets plot some fields of surface temperature. Since we have an ensemble of\npredictions, lets display the first ensemble member, which is deterministic member,\nand also the last ensemble member and the ensemmble standard deviation. One or both of\nthe perturbed members may look a little noisy, thats because our noise amplitude is\nmaybe too high. Try lowering the amplitude in the config or changing pertibation type\nto see what happens.\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">nyc_lon</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">nyc_lat</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">t2m</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">290</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;First ensemble member t2m (K)&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CenteredNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">t2m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="mi">290</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">320</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">nyc_lon</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">nyc_lat</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Last ensemble member t2m (K)&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CenteredNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="n">ds_ensemble_std</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ds_ensemble_std</span><span class="o">.</span><span class="n">t2m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="c1"># norm = TwoSlopeNorm(vmin=data.min().values, vcenter=5, vmax=data.max().values)</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">nyc_lon</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">nyc_lat</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ensemble std  t2m (K)&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;seismic&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CenteredNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">/gloabl_surface_temp_contour.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_01_ensemble_inference_002.png" srcset="../_images/sphx_glr_01_ensemble_inference_002.png, ../_images/sphx_glr_01_ensemble_inference_002_2_00x.png 2.00x" alt="First ensemble member t2m (K), Last ensemble member t2m (K), ensemble std  t2m (K)" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We can also show a map of the ensemble mean of the 10 meter zonal winds (using some</span>
<span class="sd">Nvidia style coloring!)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nWe can also show a map of the ensemble mean of the 10 meter zonal winds (using some\nNvidia style coloring!)\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Nvidia_cmap</span><span class="p">():</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#8946ff&quot;</span><span class="p">,</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span> <span class="s2">&quot;#00ff00&quot;</span><span class="p">]</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;custom_cmap&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cmap</span>


<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">ds_ensemble_mean</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ds_ensemble_mean</span><span class="o">.</span><span class="n">u10m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NearsidePerspective</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">nyc_lon</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">nyc_lat</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ens. mean 10 meter zonal wind [m/s]&quot;</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">Nvidia_cmap</span><span class="p">(),</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CenteredNorm</span><span class="p">(</span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">/gloabl_mean_zonal_wind_contour.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_01_ensemble_inference_003.png" srcset="../_images/sphx_glr_01_ensemble_inference_003.png, ../_images/sphx_glr_01_ensemble_inference_003_2_00x.png 2.00x" alt="ens. mean 10 meter zonal wind [m/s]" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Finally lets compute the latitude-weighted global averages and plot time series of</span>
<span class="sd">ensemble standard deviation.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nFinally lets compute the latitude-weighted global averages and plot time series of\nensemble standard deviation.\n&#39;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">global_average</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">cos_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">cos_lat</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">])</span>


<span class="n">ds_ensemble_std</span> <span class="o">=</span> <span class="n">global_average</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;ensemble&quot;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lead_time</span><span class="p">,</span> <span class="n">ds_ensemble_std</span><span class="o">.</span><span class="n">u10m</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;lead time [k]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;u10m std [m/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">/gloabl_std_zonal_surface_wind.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_01_ensemble_inference_004.png" srcset="../_images/sphx_glr_01_ensemble_inference_004.png, ../_images/sphx_glr_01_ensemble_inference_004_2_00x.png 2.00x" alt="01 ensemble inference" class = "sphx-glr-single-img"/><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">And that completes the introductory notebook into running ensemble weather predictions</span>
<span class="sd">with AI. In the next notebook, we will look at running different models using more</span>
<span class="sd">Pythonic APIs and plotting geopotential fields.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&#39;\nAnd that completes the introductory notebook into running ensemble weather predictions\nwith AI. In the next notebook, we will look at running different models using more\nPythonic APIs and plotting geopotential fields.\n&#39;
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (2 minutes 44.096 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-01-ensemble-inference-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/d1b155342ea8b092e4004427a675630f/01_ensemble_inference.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">01_ensemble_inference.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/7240a7800004602d706afb4c14c5b1ad/01_ensemble_inference.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">01_ensemble_inference.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Examples</p>
      </div>
    </a>
    <a class="right-next"
       href="02_model_comparison.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Basic Inference with Multiple Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/examples/01_ensemble_inference.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, NVIDIA.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>